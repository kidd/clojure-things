<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clojure things I learn</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Raimon Grau" />
<meta name="keywords" content="bash zsh shell" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Clojure things I learn</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0aad670">1. clojure</a>
<ul>
<li><a href="#org3b1c9a1">1.1. organize code</a></li>
<li><a href="#org6453f48">1.2. start an app</a>
<ul>
<li><a href="#orgcdd9428">1.2.1. lein</a></li>
<li><a href="#orgd839a6d">1.2.2. deps.edn</a></li>
<li><a href="#org79a3b2c">1.2.3. cljs</a></li>
</ul>
</li>
<li><a href="#org37af76e">1.3. deps.edn</a></li>
<li><a href="#org6275fa8">1.4. tutorials</a></li>
<li><a href="#org24ef754">1.5. shadow-cljs</a></li>
<li><a href="#org190f4a5">1.6. etaoin</a></li>
<li><a href="#org23c1373">1.7. string to uuid in postgres pg</a></li>
<li><a href="#org3e4c4ee">1.8. add libs live</a></li>
<li><a href="#2d3b5ab6-8c01-46fd-9443-e21f25a2af8c">1.9. indentation</a></li>
<li><a href="#2134230d-d0a7-430f-bff1-9f301a2306b1">1.10. lein test</a></li>
<li><a href="#e864f2cc-92b1-4c6b-ab13-c52457774398">1.11. unalias</a></li>
<li><a href="#org60045e6">1.12. socket repl</a></li>
<li><a href="#org2bd8e34">1.13. clojure by example</a></li>
<li><a href="#org1c10ba8">1.14. add conditionally to a map</a></li>
<li><a href="#org56173fb">1.15. subsets</a></li>
<li><a href="#org836cc51">1.16. Where did I leave that stuff?</a></li>
<li><a href="#orgc3671aa">1.17. Array of hashes to hash</a></li>
<li><a href="#org4b3b78c">1.18. Test private functions</a></li>
<li><a href="#org5b09705">1.19. managing exceptions in clojure</a></li>
<li><a href="#org60b2e52">1.20. mocking, stubbing, spying, integrant&#x2026;</a></li>
<li><a href="#orgf088cef">1.21. Deploy a compojure+ring app</a></li>
<li><a href="#orgf77024b">1.22. Start a compojure app</a>
<ul>
<li><a href="#org095009e">1.22.1. create</a></li>
<li><a href="#orgb7bf1b2">1.22.2. repl</a></li>
<li><a href="#org82c9229">1.22.3. DB</a></li>
<li><a href="#org7b9b1c6">1.22.4. Migrations</a></li>
</ul>
</li>
<li><a href="#orgdacc644">1.23. integrant,mount,component. clojurians #off-topic 2021-08-07</a>
<ul>
<li><a href="#org3e85d84">1.23.1. links</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge0ad54c">2. clojure exceptions</a></li>
<li><a href="#org09e2a9e">3. logging</a></li>
<li><a href="#org2c2f806">4. queryable runtime. "inspectability"</a></li>
<li><a href="#org821b2ac">5. clojure internals</a></li>
<li><a href="#orgb87f786">6. data-driven</a></li>
<li><a href="#org0ddb295">7. simple stu halloway</a></li>
</ul>
</div>
</div>
<div id="outline-container-org0aad670" class="outline-2">
<h2 id="org0aad670"><span class="section-number-2">1</span> clojure</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org3b1c9a1" class="outline-3">
<h3 id="org3b1c9a1"><span class="section-number-3">1.1</span> organize code</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li><a href="https://kumarshantanu.medium.com/organizing-clojure-code-with-functional-core-imperative-shell-2f2ee869faa2">https://kumarshantanu.medium.com/organizing-clojure-code-with-functional-core-imperative-shell-2f2ee869faa2</a></li>
<li><a href="https://clojureverse.org/t/organizing-clojure-code-a-real-problem/7567/37">https://clojureverse.org/t/organizing-clojure-code-a-real-problem/7567/37</a></li>
<li><a href="https://www.reddit.com/r/Clojure/comments/nm33gx/diving_into_clojure/">https://www.reddit.com/r/Clojure/comments/nm33gx/diving_into_clojure/</a></li>
</ul>
</div>
</div>
<div id="outline-container-org6453f48" class="outline-3">
<h3 id="org6453f48"><span class="section-number-3">1.2</span> start an app</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-orgcdd9428" class="outline-4">
<h4 id="orgcdd9428"><span class="section-number-4">1.2.1</span> lein</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
<code>lein new app foo</code>
<code>lein repl</code>
<code>lein run</code>
</p>
</div>
</div>
<div id="outline-container-orgd839a6d" class="outline-4">
<h4 id="orgd839a6d"><span class="section-number-4">1.2.2</span> deps.edn</h4>
</div>
<div id="outline-container-org79a3b2c" class="outline-4">
<h4 id="org79a3b2c"><span class="section-number-4">1.2.3</span> cljs</h4>
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">
<pre class="src src-bash">lein new re-frame foobar +10x
edit shadow-cljs.edn add lib
npx shadow-cljs watch app
cider-connect-cljs local 7888 shadow-select :app .
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37af76e" class="outline-3">
<h3 id="org37af76e"><span class="section-number-3">1.3</span> deps.edn</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li><a href="http://www.futurile.net/2020/03/07/clojure-lein-dev-experience-and-repl-tools/">http://www.futurile.net/2020/03/07/clojure-lein-dev-experience-and-repl-tools/</a></li>
<li><a href="https://www.manueluberti.eu/programming/2018/11/14/deps-shadow-cljs/">https://www.manueluberti.eu/programming/2018/11/14/deps-shadow-cljs/</a></li>
</ul>
</div>
</div>
<div id="outline-container-org6275fa8" class="outline-3">
<h3 id="org6275fa8"><span class="section-number-3">1.4</span> tutorials</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>cljs re-frame: <a href="https://www.youtube.com/user/VideosDanA">https://www.youtube.com/user/VideosDanA</a></li>
<li>spa re-frame: <a href="https://www.youtube.com/watch?v=yVb8PS6a4Mk&amp;t=666s">https://www.youtube.com/watch?v=yVb8PS6a4Mk&amp;t=666s</a></li>
<li>TODO in cljs <a href="https://www.youtube.com/watch?v=jAkw6Wb-rTA">https://www.youtube.com/watch?v=jAkw6Wb-rTA</a></li>
<li>integrant: <a href="https://www.youtube.com/playlist?list=PLb5SjnGEsSJdJnbjxVWci1P7mKY-K1ExD">https://www.youtube.com/playlist?list=PLb5SjnGEsSJdJnbjxVWci1P7mKY-K1ExD</a></li>
</ul>
</div>
</div>
<div id="outline-container-org24ef754" class="outline-3">
<h3 id="org24ef754"><span class="section-number-3">1.5</span> shadow-cljs</h3>
<div class="outline-text-3" id="text-1-5">
<p>
<a href="https://jiyinyiyong.medium.com/a-beginner-guide-to-compile-clojurescript-with-shadow-cljs-26369190b786">https://jiyinyiyong.medium.com/a-beginner-guide-to-compile-clojurescript-with-shadow-cljs-26369190b786</a>
Shadow-cljs is a tool, like make, or denom. Or lein. That builds
packages. Like lein it does the building of the pipeline, but
unlike lein, it also has the hot reload thing. So it's like
lein+repl-with-hotreload.
</p>

<p>
Figwheel and figwheel-main are alternatives to it, but they are
basically substitutes one for the other.
</p>

<p>
Clojurescript has shitloads of repls,
<a href="https://lambdaisland.com/guides/clojure-repls/clojurescript-repls#org8300646">https://lambdaisland.com/guides/clojure-repls/clojurescript-repls#org8300646</a>
.At this point, I dont' know if shadow-cljs provides its own repl
mechanism, or it's on you to say "shadow-cljs, I want you to use
rhino as a repl".
<a href="https://clojureverse.org/t/what-is-the-difference-between-figwheel-main-and-figwheel-sidecar/6832">https://clojureverse.org/t/what-is-the-difference-between-figwheel-main-and-figwheel-sidecar/6832</a>
</p>
</div>
</div>
<div id="outline-container-org190f4a5" class="outline-3">
<h3 id="org190f4a5"><span class="section-number-3">1.6</span> etaoin</h3>
<div class="outline-text-3" id="text-1-6">
<p>
selenium-like. just from clojure/babashka.
</p>
</div>
</div>
<div id="outline-container-org23c1373" class="outline-3">
<h3 id="org23c1373"><span class="section-number-3">1.7</span> string to uuid in postgres pg</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">
<pre class="src src-clojure">(ns foo.bar
 (:import java.util.UUID))
(tdb/update-where! 'Product {:id id} :user-id (java.util.UUID/fromString new-window-id)))

</pre>
</div>
</div>
</div>
<div id="outline-container-org3e4c4ee" class="outline-3">
<h3 id="org3e4c4ee"><span class="section-number-3">1.8</span> add libs live</h3>
<div class="outline-text-3" id="text-1-8">
<p>
To add libraries live you need the combination of 3 things:
</p>
<ul class="org-ul">
<li>lein</li>
<li>clj-commons/pomegranate</li>
<li><a href="https://www.eigenbahn.com/2020/05/06/fast-clojure-deps-auto-reload">https://www.eigenbahn.com/2020/05/06/fast-clojure-deps-auto-reload</a></li>
<li><a href="https://github.com/clj-commons/pomegranate">https://github.com/clj-commons/pomegranate</a></li>
<li><a href="https://github.com/clojure/tools.trace">https://github.com/clojure/tools.trace</a></li>
<li><a href="https://github.com/philoskim/debux">https://github.com/philoskim/debux</a></li>
<li><a href="https://eli.thegreenplace.net/2017/notes-on-debugging-clojure-code/">https://eli.thegreenplace.net/2017/notes-on-debugging-clojure-code/</a></li>
<li><a href="https://cognitect.com/blog/2017/6/5/repl-debugging-no-stacktrace-required">https://cognitect.com/blog/2017/6/5/repl-debugging-no-stacktrace-required</a></li>
</ul>
</div>
</div>
<div id="outline-container-org78af8e6" class="outline-3">
<h3 id="2d3b5ab6-8c01-46fd-9443-e21f25a2af8c"><a id="org78af8e6"></a><span class="section-number-3">1.9</span> indentation</h3>
<div class="outline-text-3" id="text-2d3b5ab6-8c01-46fd-9443-e21f25a2af8c">
<ul class="org-ul">
<li><a href="https://github.com/kkinnear/zprint">https://github.com/kkinnear/zprint</a></li>
<li>clj-rewrite</li>
<li>babashka stuff?</li>
</ul>
</div>
</div>
<div id="outline-container-orgb7c850e" class="outline-3">
<h3 id="2134230d-d0a7-430f-bff1-9f301a2306b1"><a id="orgb7c850e"></a><span class="section-number-3">1.10</span> lein test</h3>
<div class="outline-text-3" id="text-2134230d-d0a7-430f-bff1-9f301a2306b1">
<p>
lein test :only my.namespace/my-test
lein test :only my.namespace
</p>
</div>
</div>
<div id="outline-container-orga6672f8" class="outline-3">
<h3 id="e864f2cc-92b1-4c6b-ab13-c52457774398"><a id="orga6672f8"></a><span class="section-number-3">1.11</span> unalias</h3>
<div class="outline-text-3" id="text-e864f2cc-92b1-4c6b-ab13-c52457774398">
<p>
(ns-unalias <b>ns</b> 't)
</p>
</div>
</div>
<div id="outline-container-org60045e6" class="outline-3">
<h3 id="org60045e6"><span class="section-number-3">1.12</span> socket repl</h3>
<div class="outline-text-3" id="text-1-12">
<div class="org-src-container">
<pre class="src src-bash">java -Dclojure.server.repl={:port 6666 :accept clojure.core.server/repl} -jar target/uberjar/myuberjar.jar
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">notice in project.clj there's a :socket profile as well that i use for local dev</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2bd8e34" class="outline-3">
<h3 id="org2bd8e34"><span class="section-number-3">1.13</span> clojure by example</h3>
<div class="outline-text-3" id="text-1-13">
<p>
<a href="https://news.ycombinator.com/item?id=27273911">https://news.ycombinator.com/item?id=27273911</a>
</p>
</div>
</div>
<div id="outline-container-org1c10ba8" class="outline-3">
<h3 id="org1c10ba8"><span class="section-number-3">1.14</span> add conditionally to a map</h3>
<div class="outline-text-3" id="text-1-14">
<div class="org-src-container">
<pre class="src src-clojure">(merge base-map
   (when name
      {:name name})
   (when address
      {:address address}))

</pre>
</div>
<p>
similar to CL's `(:a 1 ,@(when foo `(:b 2)))
</p>
</div>
</div>
<div id="outline-container-org56173fb" class="outline-3">
<h3 id="org56173fb"><span class="section-number-3">1.15</span> subsets</h3>
<div class="outline-text-3" id="text-1-15">
<p>
A set is a map with values equal to keys.
</p>

<p>
Creating a map from a set is trivial, you get {:a :a, :b :b &#x2026;.}
</p>

<p>
maps can be converted to sets, and the elements are vectors of [k v]
</p>
<div class="org-src-container">
<pre class="src src-clojure">(set [1 2])                               ; #{1 2}
(set {:a 1})                              ; #{[:a 1]}
(set {:a 1})                              ; #{[:a 1]}
(set/subset? (set {:a 1}) (set {:a 1}))   ; true
(set/subset? (set {:a 1}) (set {:a 2}))   ; false
(set/subset? (set {:a 1}) (set [:a 1]))   ; false
(set/subset? (set {:a 1}) (set [:a 1]))   ; false
(set [:a 1])                              ; #{1 :a}
(set [:a :a])                             ; #{:a}
(set [[:a 1]])                            ; #{[:a 1]}
(set/subset? (set {:a 1}) (set [:a 1]))   ; false
(set/subset? (set {:a 1}) (set [[:a 1]])) ; true
(set {1 :a})                              ; #{[1 :a]}
(into {} (set {:a 1}))                   ; {:a 1}
</pre>
</div>

<p>
Even thought there might be a way to create a hash from a set like
this <code>(fun #{:a}) ; =&gt; {:a :a}</code> that would mean that you can
prepare a set and a hash that would be "equal", but from what I see
above, conversions between maps and sets work neatly.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(set/subset? (set {:a 1}) #{:a})
(set/subset? #{:a}        (set {:a 1}) )
(set/subset? #{:a}        (set [:a]) )
(set/subset? (set [:a])   #{:a})
(set/subset? (set [:a])   #{:a})
...
(set/subset? (set {:a 1}) (set [[:a 1]])); true
(set/subset? (set {:a 1}) (set [:a 1])); false
{:a 1} (into {} [[:a 1]]); {:a 1}{:a 1}
</pre>
</div>

<p>
To check for presence of required keys as parameters, it's very
easy and "apl-ish" <code>(set/subset? (set [:first-name :last-name
   :company]) (:params request))</code>
</p>
</div>
</div>

<div id="outline-container-org836cc51" class="outline-3">
<h3 id="org836cc51"><span class="section-number-3">1.16</span> Where did I leave that stuff?</h3>
<div class="outline-text-3" id="text-1-16">
<p>
So, I'm debugging something, and I use the inspector to retain some value I want for later.
<code>d myvar</code> will save that value as <code>myvar</code> in the current namespace you're in.
</p>

<p>
Later on, you move namespace and you want to get back that <code>myvar</code>
but you don't remember where it was stored.
</p>

<p>
<code>cider-apropos myvar</code> will list you which ns have this defined. so
you can go and fetch it from there.
</p>
</div>
</div>

<div id="outline-container-orgc3671aa" class="outline-3">
<h3 id="orgc3671aa"><span class="section-number-3">1.17</span> Array of hashes to hash</h3>
<div class="outline-text-3" id="text-1-17">
<div class="org-src-container">
<pre class="src src-clojure">(map (juxt :id identity) [{:id 1 :name "foo"} {:id 2 :name "bar"}])
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b3b78c" class="outline-3">
<h3 id="org4b3b78c"><span class="section-number-3">1.18</span> Test private functions</h3>
<div class="outline-text-3" id="text-1-18">
<p>
If you want to test a private function, you can use the <code>binding</code>
(which is always accessible), and call it.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(ns a.b-test
  (:use
   [clojure test]))

(deftest a-private-function-test
  (testing "a private function"
    (let [fun #'a.b/c]
      (is (not (fun nil))))))
</pre>
</div>

<p>
ref and extended explanations: <a href="https://stackoverflow.com/questions/37471253/how-can-i-write-unit-tests-for-private-clojure-functions">in stackoverflow</a>.
</p>
</div>
</div>

<div id="outline-container-org5b09705" class="outline-3">
<h3 id="org5b09705"><span class="section-number-3">1.19</span> managing exceptions in clojure</h3>
<div class="outline-text-3" id="text-1-19">
<p>
THere's some good discussion here <a href="https://clojureverse.org/t/how-are-clojurians-handling-control-flow-on-their-projects/7868">in clojurians</a> thread.
</p>
</div>
</div>

<div id="outline-container-org60b2e52" class="outline-3">
<h3 id="org60b2e52"><span class="section-number-3">1.20</span> mocking, stubbing, spying, integrant&#x2026;</h3>
<div class="outline-text-3" id="text-1-20">
<ul class="org-ul">
<li><a href="https://github.com/alexanderjamesking/spy">https://github.com/alexanderjamesking/spy</a></li>
<li><a href="https://engineering.fundingcircle.com/blog/2016/01/11/tdd-in-clojure/">https://engineering.fundingcircle.com/blog/2016/01/11/tdd-in-clojure/</a></li>
<li><a href="http://www.diva-portal.org/smash/get/diva2:806620/FULLTEXT01.pdf">http://www.diva-portal.org/smash/get/diva2:806620/FULLTEXT01.pdf</a></li>
<li><a href="http://software-ninja-ninja.blogspot.com/2014/04/5-faces-of-dependency-injection-in.html">http://software-ninja-ninja.blogspot.com/2014/04/5-faces-of-dependency-injection-in.html</a></li>
<li><a href="https://clojureverse.org/t/stuart-sierra-components-and-config/7996/7">https://clojureverse.org/t/stuart-sierra-components-and-config/7996/7</a></li>
<li><a href="https://slipset.github.io/posts/dependency-injection-perhaps">https://slipset.github.io/posts/dependency-injection-perhaps</a></li>
<li><a href="https://slipset.github.io/posts/config">https://slipset.github.io/posts/config</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgf088cef" class="outline-3">
<h3 id="orgf088cef"><span class="section-number-3">1.21</span> Deploy a compojure+ring app</h3>
<div class="outline-text-3" id="text-1-21">
<div class="org-src-container">
<pre class="src src-bash">lein new compojure hello-api-clj
<span style="font-weight: bold;">cd</span> hello-api-clj
lein ring uberjar
java -jar target/hello-api-clj-0.1.0-SNAPSHOT-standalone.jar
</pre>
</div>

<p>
OR
</p>

<div class="org-src-container">
<pre class="src src-bash">lein new compojure hello-api-clj
<span style="font-weight: bold;">cd</span> hello-api-clj
lein ring uberjar
java -jar target/hello-api-clj-0.1.0-SNAPSHOT-standalone.jar
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf77024b" class="outline-3">
<h3 id="orgf77024b"><span class="section-number-3">1.22</span> Start a compojure app</h3>
<div class="outline-text-3" id="text-1-22">
<p>
There are multiple templates,
</p>
<ul class="org-ul">
<li><a href="https://github.com/yogthos/compojure-template/">https://github.com/yogthos/compojure-template/</a></li>
<li><a href="https://practical.li/clojure-webapps/server-side-api/compojure-api-template.html">https://practical.li/clojure-webapps/server-side-api/compojure-api-template.html</a></li>
<li><p>
<a href="https://github.com/weavejester/compojure-template">https://github.com/weavejester/compojure-template</a>
&#x2026;
</p>

<p>
I'm going for compojure-template for now. No reason why, really.
</p></li>
</ul>
</div>
<div id="outline-container-org095009e" class="outline-4">
<h4 id="org095009e"><span class="section-number-4">1.22.1</span> create</h4>
<div class="outline-text-4" id="text-1-22-1">
<div class="org-src-container">
<pre class="src src-bash">lein new compojure my-stupid-app
lein ring server
</pre>
</div>

<p>
lein-ring uses a fancy way to start the server, so you don't have
an easy entrypoint before the server is kicked (integrant?, mount?,
component?).
</p>
</div>
</div>

<div id="outline-container-orgb7bf1b2" class="outline-4">
<h4 id="orgb7bf1b2"><span class="section-number-4">1.22.2</span> repl</h4>
<div class="outline-text-4" id="text-1-22-2">
<p>
if you want to start the repl when <code>lein ring server</code>, add in
project.clj <code>:nrepl {:start? true}</code>.
</p>

<p>
lein ring server imports ring and ring-server/ring-server, which
run the jetty server for you on start
<a href="https://github.com/weavejester/lein-ring/blob/master/src/leiningen/ring/server.clj#L34-L35">https://github.com/weavejester/lein-ring/blob/master/src/leiningen/ring/server.clj#L34-L35</a>
</p>

<p>
But if you want control over it, add [ring "1.9.4"] explicitly to
your project.clj, start with cider-jack-in, and in the main ns,
</p>

<div class="org-src-container">
<pre class="src src-clojure">(use 'ring.adapter.jetty) ; if you don't require [ring ..] this is not available
(defonce server (run-jetty #'app {:port 3000 :join? false}))
(.stop server)
</pre>
</div>
</div>
</div>

<div id="outline-container-org82c9229" class="outline-4">
<h4 id="org82c9229"><span class="section-number-4">1.22.3</span> DB</h4>
</div>

<div id="outline-container-org7b9b1c6" class="outline-4">
<h4 id="org7b9b1c6"><span class="section-number-4">1.22.4</span> Migrations</h4>
<div class="outline-text-4" id="text-1-22-4">
<p>
Migratus provides the lib AND the lein plugin.
</p>

<p>
You have to add next.jdbc AND the concrete driver for your db
sqlite-jdbc in my case.
</p>

<p>
At this point to debug, I found that if you start from the console
with <code>lein ring server</code> even if there is a repl, the process
doesn't have the nrepl and cider helpers, so it's not really
useful as a repl to be used from emacs. Interim solution:
<code>cider-jack-in</code> and not have the server on.  Have to figure that
one asap.
</p>
</div>
</div>
</div>



<div id="outline-container-orgdacc644" class="outline-3">
<h3 id="orgdacc644"><span class="section-number-3">1.23</span> integrant,mount,component. clojurians #off-topic 2021-08-07</h3>
<div class="outline-text-3" id="text-1-23">
</div>
<div id="outline-container-org3e85d84" class="outline-4">
<h4 id="org3e85d84"><span class="section-number-4">1.23.1</span> links</h4>
<div class="outline-text-4" id="text-1-23-1">
<ul class="org-ul">
<li><a href="https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-2-897aa28112da">https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-2-897aa28112da</a></li>
</ul>
<ul class="org-ul">
<li><a href="https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-1-6e819f51db14">https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-1-6e819f51db14</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orge0ad54c" class="outline-2">
<h2 id="orge0ad54c"><span class="section-number-2">2</span> clojure exceptions</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li><a href="https://grishaev.me/en/clj-book-exceptions/">https://grishaev.me/en/clj-book-exceptions/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org09e2a9e" class="outline-2">
<h2 id="org09e2a9e"><span class="section-number-2">3</span> logging</h2>
<div class="outline-text-2" id="text-3">
<p>
timbre/log provides also <code>spy</code> and other cool stuff
</p>
</div>
</div>

<div id="outline-container-org2c2f806" class="outline-2">
<h2 id="org2c2f806"><span class="section-number-2">4</span> queryable runtime. "inspectability"</h2>
<div class="outline-text-2" id="text-4">
<p>
cider-apropos is super useful
</p>
<div class="org-src-container">
<pre class="src src-clojure">(apropos "rename-keys")
(clojure.set/rename-keys)

(doc clojure.test)
(find-doc "dynamic")
</pre>
</div>
<pre class="example">
for instance, this is our production jar:
MB_JETTY_PORT=3006 java -Dclojure.server.repl="{:port 50506 :accept clojure.core.server/repl}" -jar 0.40.0.jar
and then just a simple

% nc localhost 50506
user=&gt; (apply require clojure.main/repl-requires)
nil
user=&gt; (apropos "union")
(clojure.set/union)
user=&gt; (apropos "password")
(clj-ldap.client/modify-password metabase.api.session/GET_password_reset_token_valid metabase.api.session/POST_forgot_password metabase.api.session/POST_reset_password metabase.api.user/PUT_:id_password metabase.api.util/POST_password_check metabase.driver.common/default-password-details metabase.email/email-smtp-password metabase.email.messages/send-password-reset-email! metabase.integrations.ldap/ldap-password metabase.integrations.ldap/verify-password metabase.models.database/protected-password metabase.models.user/form-password-reset-url metabase.models.user/set-password! metabase.models.user/set-password-reset-token! metabase.public-settings/enable-password-login metabase.public-settings/password-complexity metabase.util.password/active-password-complexity metabase.util.password/common-passwords-url metabase.util.password/verify-password)
user=&gt;
</pre>
<pre class="example">
  I once wondered how many things were added to clojure.core over the versions. After cloning the Clojure repo, and doing weird regex checks across history in git, I realised I could just do this:

user=&gt; (-&gt;&gt; (vals (ns-publics 'clojure.core))
  #_=&gt;      (keep (comp :added meta))
  #_=&gt;      (frequencies)
  #_=&gt;      (sort-by #(Long/parseLong (subs (key %) 2)))
  #_=&gt;      (run! println))
[1.0 434]
[1.1 38]
[1.2 45]
[1.3 16]
[1.4 8]
[1.5 11]
[1.6 8]
[1.7 19]
[1.8 1]
[1.9 27]
[1.10 8]

That's when I started to really "get" the value of the queryability. I then understood how easily I could implement my own version of clojure.repl/apropos.
Edit: fixed the sorting. (edited)
</pre>
</div>
</div>

<div id="outline-container-org821b2ac" class="outline-2">
<h2 id="org821b2ac"><span class="section-number-2">5</span> clojure internals</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li><a href="https://aphyr.com/posts/305-clojure-from-the-ground-up-macros">https://aphyr.com/posts/305-clojure-from-the-ground-up-macros</a></li>
<li><a href="https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie">https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie</a></li>
<li><a href="http://blog.kdgregory.com/2016/05/how-and-when-clojure-compiles-your-code.html">http://blog.kdgregory.com/2016/05/how-and-when-clojure-compiles-your-code.html</a></li>
<li><a href="https://www.youtube.com/watch?v=2SGFeegEt9E">https://www.youtube.com/watch?v=2SGFeegEt9E</a> &lt;- decompilation</li>
<li><a href="https://dev.to/dpsutton/exploring-the-core-cache-api-57al">https://dev.to/dpsutton/exploring-the-core-cache-api-57al</a></li>
<li><a href="https://worace.works/2021/04/13/jar-hell-part-2-jvm-deployment-strategies/">https://worace.works/2021/04/13/jar-hell-part-2-jvm-deployment-strategies/</a></li>
<li><a href="https://www.deepbluelambda.org/programming/clojure/how-clojure-works-a-simple-namespace">https://www.deepbluelambda.org/programming/clojure/how-clojure-works-a-simple-namespace</a></li>
<li><a href="https://www.deepbluelambda.org/programming/clojure/how-clojure-works-namespace-metadata">https://www.deepbluelambda.org/programming/clojure/how-clojure-works-namespace-metadata</a></li>
<li><a href="https://leiningen.org/reference.html">https://leiningen.org/reference.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgb87f786" class="outline-2">
<h2 id="orgb87f786"><span class="section-number-2">6</span> data-driven</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=IZlt6hH8YiA">https://www.youtube.com/watch?v=IZlt6hH8YiA</a></li>
<li><a href="https://www.youtube.com/watch?v=kuNxVXnmjHA">https://www.youtube.com/watch?v=kuNxVXnmjHA</a></li>
<li><a href="https://www.youtube.com/watch?v=zznwKCifC1A">https://www.youtube.com/watch?v=zznwKCifC1A</a></li>
<li><a href="https://www.youtube.com/watch?v=WtdegIqQbrg">https://www.youtube.com/watch?v=WtdegIqQbrg</a></li>
</ul>
</div>
</div>

<div id="outline-container-org0ddb295" class="outline-2">
<h2 id="org0ddb295"><span class="section-number-2">7</span> simple stu halloway</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=cidchWg74Y4">https://www.youtube.com/watch?v=cidchWg74Y4</a> simplicity &#x2026;</li>
<li><a href="https://www.youtube.com/watch?v=f_Fi8YXt2fs">https://www.youtube.com/watch?v=f_Fi8YXt2fs</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Raimon Grau</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.1.9)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
