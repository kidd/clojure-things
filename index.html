<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clojure things I learn</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Raimon Grau" />
<meta name="keywords" content="bash zsh shell" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Clojure things I learn</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbcae83c">1. clojure</a>
<ul>
<li><a href="#org6681823">1.1. organize code</a></li>
<li><a href="#org5e706c9">1.2. start an app</a>
<ul>
<li><a href="#org4f4c56f">1.2.1. lein</a></li>
<li><a href="#orgf493da5">1.2.2. deps.edn</a></li>
<li><a href="#orgad1d842">1.2.3. cljs</a></li>
</ul>
</li>
<li><a href="#orgc6c697d">1.3. deps.edn</a></li>
<li><a href="#org7a5aa63">1.4. tutorials</a></li>
<li><a href="#orgf0fe5ba">1.5. shadow-cljs</a></li>
<li><a href="#org6896c23">1.6. etaoin</a></li>
<li><a href="#org99d4d11">1.7. string to uuid in postgres pg</a></li>
<li><a href="#org6755971">1.8. add libs live</a></li>
<li><a href="#2d3b5ab6-8c01-46fd-9443-e21f25a2af8c">1.9. indentation</a></li>
<li><a href="#2134230d-d0a7-430f-bff1-9f301a2306b1">1.10. lein test</a></li>
<li><a href="#e864f2cc-92b1-4c6b-ab13-c52457774398">1.11. unalias</a></li>
<li><a href="#org17b2ced">1.12. socket repl</a></li>
<li><a href="#org87d7c31">1.13. clojure by example</a></li>
<li><a href="#org1eec64e">1.14. add conditionally to a map</a></li>
<li><a href="#org6fe53d6">1.15. subsets</a></li>
<li><a href="#org0b82897">1.16. Where did I leave that stuff?</a></li>
<li><a href="#orga12a631">1.17. Array of hashes to hash</a></li>
<li><a href="#org9410b45">1.18. Test private functions</a></li>
<li><a href="#org531fe29">1.19. managing exceptions in clojure</a></li>
<li><a href="#orgb5a18df">1.20. mocking, stubbing, spying, integrant&#x2026;</a></li>
<li><a href="#orgd9fa608">1.21. Start a compojure app</a>
<ul>
<li><a href="#orgbbc8d58">1.21.1. lein&amp;ring info and tutorials</a></li>
<li><a href="#orgfc43257">1.21.2. There are multiple templates,</a></li>
<li><a href="#orgadb11b1">1.21.3. Deploy a compojure+ring app</a></li>
<li><a href="#org2b1f07a">1.21.4. create</a></li>
<li><a href="#org057b175">1.21.5. repl</a></li>
<li><a href="#org5b80909">1.21.6. DB</a></li>
<li><a href="#orge5484ae">1.21.7. Migrations</a></li>
<li><a href="#orga7febdf">1.21.8. Migrations in prod</a></li>
<li><a href="#org5161886">1.21.9. uberjar</a></li>
<li><a href="#org93830a8">1.21.10. Security</a></li>
<li><a href="#orgeea3356">1.21.11. honeysql and next/jdbc</a></li>
<li><a href="#orgc6b32b0">1.21.12. deploy</a></li>
</ul>
</li>
<li><a href="#org692bfa0">1.22. Circleci 3part tutorial on duct, aws , terraform</a></li>
<li><a href="#org7730553">1.23. integrant,mount,component. clojurians #off-topic 2021-08-07</a>
<ul>
<li><a href="#orgb3ba159">1.23.1. links</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge9f2e9d">2. clojure exceptions</a></li>
<li><a href="#org85bc25a">3. logging</a></li>
<li><a href="#orge990354">4. concat trap</a></li>
<li><a href="#orgdd7fb77">5. queryable runtime. "inspectability"</a></li>
<li><a href="#org97557fa">6. clojure internals</a></li>
<li><a href="#orgb220b90">7. data-driven</a></li>
<li><a href="#org8aa6a4f">8. simple stu halloway</a></li>
<li><a href="#org0f9feda">9. cljs</a>
<ul>
<li><a href="#org77b46aa">9.1. storybook</a></li>
</ul>
</li>
<li><a href="#orgf53a39e">10. core.async</a></li>
<li><a href="#orgec47a11">11. java interop</a></li>
<li><a href="#org264489b">12. tricky flatten</a></li>
<li><a href="#orgd2d0c96">13. modern clojurescript</a></li>
<li><a href="#org87b6738">14. clojure integrant and the like</a></li>
<li><a href="#org75f9310">15. holy lambda!</a></li>
<li><a href="#org21b3da6">16. web dev</a></li>
<li><a href="#org508e44e">17. nested filtering, some, any , every , filter&#x2026;.</a></li>
<li><a href="#org9960e51">18. list all implementations of a defmethod</a></li>
<li><a href="#org67b616a">19. find all public methods of a namespace</a></li>
<li><a href="#org1ae93d4">20. cli and tools and deps</a></li>
<li><a href="#org3627fc4">21. dependency injection</a></li>
<li><a href="#orgeef31aa">22. clojure codebases</a></li>
<li><a href="#org2d8cc12">23. REPL large objects</a></li>
<li><a href="#org97dc828">24. inspect last result in emacs</a></li>
<li><a href="#orgee27e54">25. packaging lein deps.edn</a></li>
<li><a href="#org40776f3">26. forms</a></li>
<li><a href="#org6099974">27. state machine to parse files</a></li>
<li><a href="#orga98b7bb">28. tap&gt;</a></li>
<li><a href="#org2b16ce5">29. clojure -Sdescribe</a></li>
<li><a href="#org9969fea">30. miniupdates in python</a></li>
<li><a href="#org7aad4f0">31. proj from scratche</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgbcae83c" class="outline-2">
<h2 id="orgbcae83c"><span class="section-number-2">1</span> clojure</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org6681823" class="outline-3">
<h3 id="org6681823"><span class="section-number-3">1.1</span> organize code</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li><a href="https://kumarshantanu.medium.com/organizing-clojure-code-with-functional-core-imperative-shell-2f2ee869faa2">https://kumarshantanu.medium.com/organizing-clojure-code-with-functional-core-imperative-shell-2f2ee869faa2</a></li>
<li><a href="https://clojureverse.org/t/organizing-clojure-code-a-real-problem/7567/37">https://clojureverse.org/t/organizing-clojure-code-a-real-problem/7567/37</a></li>
<li><a href="https://www.reddit.com/r/Clojure/comments/nm33gx/diving_into_clojure/">https://www.reddit.com/r/Clojure/comments/nm33gx/diving_into_clojure/</a></li>
</ul>
</div>
</div>
<div id="outline-container-org5e706c9" class="outline-3">
<h3 id="org5e706c9"><span class="section-number-3">1.2</span> start an app</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org4f4c56f" class="outline-4">
<h4 id="org4f4c56f"><span class="section-number-4">1.2.1</span> lein</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
<code>lein new app foo</code>
<code>lein repl</code>
<code>lein run</code>
</p>
</div>
</div>
<div id="outline-container-orgf493da5" class="outline-4">
<h4 id="orgf493da5"><span class="section-number-4">1.2.2</span> deps.edn</h4>
</div>
<div id="outline-container-orgad1d842" class="outline-4">
<h4 id="orgad1d842"><span class="section-number-4">1.2.3</span> cljs</h4>
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">
<pre class="src src-bash">lein new re-frame foobar +10x
edit shadow-cljs.edn add lib
npx shadow-cljs watch app
cider-connect-cljs local 7888 shadow-select :app .
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc6c697d" class="outline-3">
<h3 id="orgc6c697d"><span class="section-number-3">1.3</span> deps.edn</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li><a href="http://www.futurile.net/2020/03/07/clojure-lein-dev-experience-and-repl-tools/">http://www.futurile.net/2020/03/07/clojure-lein-dev-experience-and-repl-tools/</a></li>
<li><a href="https://www.manueluberti.eu/programming/2018/11/14/deps-shadow-cljs/">https://www.manueluberti.eu/programming/2018/11/14/deps-shadow-cljs/</a></li>
<li><a href="https://www.youtube.com/watch?v=8aCO_wNuScQ">https://www.youtube.com/watch?v=8aCO_wNuScQ</a></li>
</ul>
</div>
</div>
<div id="outline-container-org7a5aa63" class="outline-3">
<h3 id="org7a5aa63"><span class="section-number-3">1.4</span> tutorials</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>cljs re-frame: <a href="https://www.youtube.com/user/VideosDanA">https://www.youtube.com/user/VideosDanA</a></li>
<li>spa re-frame: <a href="https://www.youtube.com/watch?v=yVb8PS6a4Mk&amp;t=666s">https://www.youtube.com/watch?v=yVb8PS6a4Mk&amp;t=666s</a></li>
<li>TODO in cljs <a href="https://www.youtube.com/watch?v=jAkw6Wb-rTA">https://www.youtube.com/watch?v=jAkw6Wb-rTA</a></li>
<li>integrant: <a href="https://www.youtube.com/playlist?list=PLb5SjnGEsSJdJnbjxVWci1P7mKY-K1ExD">https://www.youtube.com/playlist?list=PLb5SjnGEsSJdJnbjxVWci1P7mKY-K1ExD</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgf0fe5ba" class="outline-3">
<h3 id="orgf0fe5ba"><span class="section-number-3">1.5</span> shadow-cljs</h3>
<div class="outline-text-3" id="text-1-5">
<p>
<a href="https://jiyinyiyong.medium.com/a-beginner-guide-to-compile-clojurescript-with-shadow-cljs-26369190b786">https://jiyinyiyong.medium.com/a-beginner-guide-to-compile-clojurescript-with-shadow-cljs-26369190b786</a>
Shadow-cljs is a tool, like make, or denom. Or lein. That builds
packages. Like lein it does the building of the pipeline, but
unlike lein, it also has the hot reload thing. So it's like
lein+repl-with-hotreload.
</p>

<p>
Figwheel and figwheel-main are alternatives to it, but they are
basically substitutes one for the other.
</p>

<p>
Clojurescript has shitloads of repls,
<a href="https://lambdaisland.com/guides/clojure-repls/clojurescript-repls#org8300646">https://lambdaisland.com/guides/clojure-repls/clojurescript-repls#org8300646</a>
.At this point, I dont' know if shadow-cljs provides its own repl
mechanism, or it's on you to say "shadow-cljs, I want you to use
rhino as a repl".
<a href="https://clojureverse.org/t/what-is-the-difference-between-figwheel-main-and-figwheel-sidecar/6832">https://clojureverse.org/t/what-is-the-difference-between-figwheel-main-and-figwheel-sidecar/6832</a>
</p>
</div>
</div>
<div id="outline-container-org6896c23" class="outline-3">
<h3 id="org6896c23"><span class="section-number-3">1.6</span> etaoin</h3>
<div class="outline-text-3" id="text-1-6">
<p>
selenium-like. just from clojure/babashka.
</p>
</div>
</div>
<div id="outline-container-org99d4d11" class="outline-3">
<h3 id="org99d4d11"><span class="section-number-3">1.7</span> string to uuid in postgres pg</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">
<pre class="src src-clojure">(ns foo.bar
 (:import java.util.UUID))
(tdb/update-where! 'Product {:id id} :user-id (java.util.UUID/fromString new-window-id)))

</pre>
</div>
</div>
</div>
<div id="outline-container-org6755971" class="outline-3">
<h3 id="org6755971"><span class="section-number-3">1.8</span> add libs live</h3>
<div class="outline-text-3" id="text-1-8">
<p>
To add libraries live you need the combination of 3 things:
</p>
<ul class="org-ul">
<li>lein</li>
<li>clj-commons/pomegranate</li>
<li><a href="https://www.eigenbahn.com/2020/05/06/fast-clojure-deps-auto-reload">https://www.eigenbahn.com/2020/05/06/fast-clojure-deps-auto-reload</a></li>
<li><a href="https://github.com/clj-commons/pomegranate">https://github.com/clj-commons/pomegranate</a></li>
<li><a href="https://github.com/clojure/tools.trace">https://github.com/clojure/tools.trace</a></li>
<li><a href="https://github.com/philoskim/debux">https://github.com/philoskim/debux</a></li>
<li><a href="https://eli.thegreenplace.net/2017/notes-on-debugging-clojure-code/">https://eli.thegreenplace.net/2017/notes-on-debugging-clojure-code/</a></li>
<li><a href="https://cognitect.com/blog/2017/6/5/repl-debugging-no-stacktrace-required">https://cognitect.com/blog/2017/6/5/repl-debugging-no-stacktrace-required</a></li>
</ul>
</div>
</div>
<div id="outline-container-org74d15af" class="outline-3">
<h3 id="2d3b5ab6-8c01-46fd-9443-e21f25a2af8c"><a id="org74d15af"></a><span class="section-number-3">1.9</span> indentation</h3>
<div class="outline-text-3" id="text-2d3b5ab6-8c01-46fd-9443-e21f25a2af8c">
<ul class="org-ul">
<li><a href="https://github.com/kkinnear/zprint">https://github.com/kkinnear/zprint</a></li>
<li>clj-rewrite</li>
<li>babashka stuff?</li>
</ul>
</div>
</div>
<div id="outline-container-org303e21b" class="outline-3">
<h3 id="2134230d-d0a7-430f-bff1-9f301a2306b1"><a id="org303e21b"></a><span class="section-number-3">1.10</span> lein test</h3>
<div class="outline-text-3" id="text-2134230d-d0a7-430f-bff1-9f301a2306b1">
<p>
lein test :only my.namespace/my-test
lein test :only my.namespace
</p>
</div>
</div>
<div id="outline-container-org35c7953" class="outline-3">
<h3 id="e864f2cc-92b1-4c6b-ab13-c52457774398"><a id="org35c7953"></a><span class="section-number-3">1.11</span> unalias</h3>
<div class="outline-text-3" id="text-e864f2cc-92b1-4c6b-ab13-c52457774398">
<p>
(ns-unalias <b>ns</b> 't)
</p>
</div>
</div>
<div id="outline-container-org17b2ced" class="outline-3">
<h3 id="org17b2ced"><span class="section-number-3">1.12</span> socket repl</h3>
<div class="outline-text-3" id="text-1-12">
<div class="org-src-container">
<pre class="src src-bash">java -Dclojure.server.repl={:port 6666 :accept clojure.core.server/repl} -jar target/uberjar/myuberjar.jar
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">notice in project.clj there's a :socket profile as well that i use for local dev</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org87d7c31" class="outline-3">
<h3 id="org87d7c31"><span class="section-number-3">1.13</span> clojure by example</h3>
<div class="outline-text-3" id="text-1-13">
<p>
<a href="https://news.ycombinator.com/item?id=27273911">https://news.ycombinator.com/item?id=27273911</a>
</p>
</div>
</div>
<div id="outline-container-org1eec64e" class="outline-3">
<h3 id="org1eec64e"><span class="section-number-3">1.14</span> add conditionally to a map</h3>
<div class="outline-text-3" id="text-1-14">
<div class="org-src-container">
<pre class="src src-clojure">(merge base-map
   (when name
      {:name name})
   (when address
      {:address address}))

</pre>
</div>
<p>
similar to CL's `(:a 1 ,@(when foo `(:b 2)))
</p>
</div>
</div>
<div id="outline-container-org6fe53d6" class="outline-3">
<h3 id="org6fe53d6"><span class="section-number-3">1.15</span> subsets</h3>
<div class="outline-text-3" id="text-1-15">
<p>
A set is a map with values equal to keys.
</p>

<p>
Creating a map from a set is trivial, you get {:a :a, :b :b &#x2026;.}
</p>

<p>
maps can be converted to sets, and the elements are vectors of [k v]
</p>
<div class="org-src-container">
<pre class="src src-clojure">(set [1 2])                               ; #{1 2}
(set {:a 1})                              ; #{[:a 1]}
(set {:a 1})                              ; #{[:a 1]}
(set/subset? (set {:a 1}) (set {:a 1}))   ; true
(set/subset? (set {:a 1}) (set {:a 2}))   ; false
(set/subset? (set {:a 1}) (set [:a 1]))   ; false
(set/subset? (set {:a 1}) (set [:a 1]))   ; false
(set [:a 1])                              ; #{1 :a}
(set [:a :a])                             ; #{:a}
(set [[:a 1]])                            ; #{[:a 1]}
(set/subset? (set {:a 1}) (set [:a 1]))   ; false
(set/subset? (set {:a 1}) (set [[:a 1]])) ; true
(set {1 :a})                              ; #{[1 :a]}
(into {} (set {:a 1}))                   ; {:a 1}
</pre>
</div>

<p>
Even thought there might be a way to create a hash from a set like
this <code>(fun #{:a}) ; =&gt; {:a :a}</code> that would mean that you can
prepare a set and a hash that would be "equal", but from what I see
above, conversions between maps and sets work neatly.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(set/subset? (set {:a 1}) #{:a})
(set/subset? #{:a}        (set {:a 1}) )
(set/subset? #{:a}        (set [:a]) )
(set/subset? (set [:a])   #{:a})
(set/subset? (set [:a])   #{:a})
...
(set/subset? (set {:a 1}) (set [[:a 1]])); true
(set/subset? (set {:a 1}) (set [:a 1])); false
{:a 1} (into {} [[:a 1]]); {:a 1}{:a 1}
</pre>
</div>

<p>
Instead of checking <code>#(every? (partial contains? %) [:a :b]) vs
   #(set/subset? #{:a :b :c} %)</code> To check for presence of required
keys as parameters, it's very easy and "apl-ish" <code>(set/subset? (set
   [:first-name :last-name :company]) (:params request))</code>
</p>
</div>
</div>

<div id="outline-container-org0b82897" class="outline-3">
<h3 id="org0b82897"><span class="section-number-3">1.16</span> Where did I leave that stuff?</h3>
<div class="outline-text-3" id="text-1-16">
<p>
So, I'm debugging something, and I use the inspector to retain some value I want for later.
<code>d myvar</code> will save that value as <code>myvar</code> in the current namespace you're in.
</p>

<p>
Later on, you move namespace and you want to get back that <code>myvar</code>
but you don't remember where it was stored.
</p>

<p>
<code>cider-apropos myvar</code> will list you which ns have this defined. so
you can go and fetch it from there.
</p>
</div>
</div>

<div id="outline-container-orga12a631" class="outline-3">
<h3 id="orga12a631"><span class="section-number-3">1.17</span> Array of hashes to hash</h3>
<div class="outline-text-3" id="text-1-17">
<div class="org-src-container">
<pre class="src src-clojure">(map (juxt :id identity) [{:id 1 :name "foo"} {:id 2 :name "bar"}])
</pre>
</div>
</div>
</div>

<div id="outline-container-org9410b45" class="outline-3">
<h3 id="org9410b45"><span class="section-number-3">1.18</span> Test private functions</h3>
<div class="outline-text-3" id="text-1-18">
<p>
If you want to test a private function, you can use the <code>binding</code>
(which is always accessible), and call it.
</p>

<div class="org-src-container">
<pre class="src src-clojure">(ns a.b-test
  (:use
   [clojure test]))

(deftest a-private-function-test
  (testing "a private function"
    (let [fun #'a.b/c]
      (is (not (fun nil))))))
</pre>
</div>

<p>
ref and extended explanations: <a href="https://stackoverflow.com/questions/37471253/how-can-i-write-unit-tests-for-private-clojure-functions">in stackoverflow</a>.
</p>
</div>
</div>

<div id="outline-container-org531fe29" class="outline-3">
<h3 id="org531fe29"><span class="section-number-3">1.19</span> managing exceptions in clojure</h3>
<div class="outline-text-3" id="text-1-19">
<p>
THere's some good discussion here <a href="https://clojureverse.org/t/how-are-clojurians-handling-control-flow-on-their-projects/7868">in clojurians</a> thread.
</p>
</div>
</div>

<div id="outline-container-orgb5a18df" class="outline-3">
<h3 id="orgb5a18df"><span class="section-number-3">1.20</span> mocking, stubbing, spying, integrant&#x2026;</h3>
<div class="outline-text-3" id="text-1-20">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=fgOfYyTeBaQ">https://www.youtube.com/watch?v=fgOfYyTeBaQ</a></li>
<li><a href="https://promesante.github.io/2021/04/28/clojure_repl_driven_development_part_1.html">https://promesante.github.io/2021/04/28/clojure_repl_driven_development_part_1.html</a></li>
<li><a href="https://github.com/alexanderjamesking/spy">https://github.com/alexanderjamesking/spy</a></li>
<li><a href="https://engineering.fundingcircle.com/blog/2016/01/11/tdd-in-clojure/">https://engineering.fundingcircle.com/blog/2016/01/11/tdd-in-clojure/</a></li>
<li><a href="http://www.diva-portal.org/smash/get/diva2:806620/FULLTEXT01.pdf">http://www.diva-portal.org/smash/get/diva2:806620/FULLTEXT01.pdf</a></li>
<li><a href="http://software-ninja-ninja.blogspot.com/2014/04/5-faces-of-dependency-injection-in.html">http://software-ninja-ninja.blogspot.com/2014/04/5-faces-of-dependency-injection-in.html</a></li>
<li><a href="https://clojureverse.org/t/stuart-sierra-components-and-config/7996/7">https://clojureverse.org/t/stuart-sierra-components-and-config/7996/7</a></li>
<li><a href="https://slipset.github.io/posts/dependency-injection-perhaps">https://slipset.github.io/posts/dependency-injection-perhaps</a></li>
<li><a href="https://slipset.github.io/posts/config">https://slipset.github.io/posts/config</a></li>
<li><a href="https://slipset.github.io/posts/all-your-base">https://slipset.github.io/posts/all-your-base</a></li>
<li><a href="https://github.com/donut-power/system">https://github.com/donut-power/system</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgd9fa608" class="outline-3">
<h3 id="orgd9fa608"><span class="section-number-3">1.21</span> Start a compojure app</h3>
<div class="outline-text-3" id="text-1-21">
</div>
<div id="outline-container-orgbbc8d58" class="outline-4">
<h4 id="orgbbc8d58"><span class="section-number-4">1.21.1</span> lein&amp;ring info and tutorials</h4>
<div class="outline-text-4" id="text-1-21-1">
<ul class="org-ul">
<li><a href="https://www.baeldung.com/leiningen-clojure">https://www.baeldung.com/leiningen-clojure</a></li>
<li><a href="https://www.baeldung.com/clojure-ring">https://www.baeldung.com/clojure-ring</a></li>
<li><a href="https://medium.com/@daniel.oliver.king/getting-real-work-done-in-clojure-application-development-683c8129a313">https://medium.com/@daniel.oliver.king/getting-real-work-done-in-clojure-application-development-683c8129a313</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgfc43257" class="outline-4">
<h4 id="orgfc43257"><span class="section-number-4">1.21.2</span> There are multiple templates,</h4>
<div class="outline-text-4" id="text-1-21-2">
<ul class="org-ul">
<li><a href="https://github.com/yogthos/compojure-template/">https://github.com/yogthos/compojure-template/</a></li>
<li><a href="https://practical.li/clojure-webapps/server-side-api/compojure-api-template.html">https://practical.li/clojure-webapps/server-side-api/compojure-api-template.html</a></li>
<li><a href="https://github.com/weavejester/compojure-template">https://github.com/weavejester/compojure-template</a>
&#x2026;</li>
</ul>
</div>
</div>
<div id="outline-container-orgadb11b1" class="outline-4">
<h4 id="orgadb11b1"><span class="section-number-4">1.21.3</span> Deploy a compojure+ring app</h4>
<div class="outline-text-4" id="text-1-21-3">
<div class="org-src-container">
<pre class="src src-bash">lein new compojure hello-api-clj
<span style="font-weight: bold;">cd</span> hello-api-clj
lein ring uberjar <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">lein uberjar without 'ring' leaves you at the repl</span>
java -jar target/hello-api-clj-0.1.0-SNAPSHOT-standalone.jar
</pre>
</div>

<p>
OR
</p>

<div class="org-src-container">
<pre class="src src-bash">lein new compojure hello-api-clj
<span style="font-weight: bold;">cd</span> hello-api-clj
lein ring uberjar
java -jar target/hello-api-clj-0.1.0-SNAPSHOT-standalone.jar
</pre>
</div>

<p>
If you were using tools.deps, there's no lein ring, or lein ring
uberjar,
<a href="https://practical.li/clojure-webapps/projects/banking-on-clojure/application-server-configuration.html">https://practical.li/clojure-webapps/projects/banking-on-clojure/application-server-configuration.html</a>
shows how to do it there.
</p>


<p>
I'm going for compojure-template for now. No reason why, really.
</p>
</div>
</div>
<div id="outline-container-org2b1f07a" class="outline-4">
<h4 id="org2b1f07a"><span class="section-number-4">1.21.4</span> create</h4>
<div class="outline-text-4" id="text-1-21-4">
<div class="org-src-container">
<pre class="src src-bash">lein new compojure my-stupid-app
lein ring server
</pre>
</div>

<p>
lein-ring uses a fancy way to start the server, so you don't have
an easy entrypoint before the server is kicked (integrant?, mount?,
component?).
</p>
</div>
</div>

<div id="outline-container-org057b175" class="outline-4">
<h4 id="org057b175"><span class="section-number-4">1.21.5</span> repl</h4>
<div class="outline-text-4" id="text-1-21-5">
<p>
if you want to start the repl when <code>lein ring server</code>, add in
project.clj <code>:nrepl {:start? true}</code>.
</p>

<p>
lein ring server imports ring and ring-server/ring-server, which
run the jetty server for you on start
<a href="https://github.com/weavejester/lein-ring/blob/master/src/leiningen/ring/server.clj#L34-L35">https://github.com/weavejester/lein-ring/blob/master/src/leiningen/ring/server.clj#L34-L35</a>
</p>

<p>
But if you want control over it, add [ring "1.9.4"] explicitly to
your project.clj, start with cider-jack-in, and in the main ns,
</p>

<div class="org-src-container">
<pre class="src src-clojure">(use 'ring.adapter.jetty) ; if you don't require [ring ..] this is not available
(defonce server (run-jetty #'app {:port 3000 :join? false}))
(.stop server)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b80909" class="outline-4">
<h4 id="org5b80909"><span class="section-number-4">1.21.6</span> DB</h4>
</div>

<div id="outline-container-orge5484ae" class="outline-4">
<h4 id="orge5484ae"><span class="section-number-4">1.21.7</span> Migrations</h4>
<div class="outline-text-4" id="text-1-21-7">
<p>
Migratus provides the lib AND the lein plugin.
</p>

<p>
You have to add next.jdbc AND the concrete driver for your db
sqlite-jdbc in my case.
</p>

<p>
At this point to debug, I found that if you start from the console
with <code>lein ring server</code> even if there is a repl, the process
doesn't have the nrepl and cider helpers, so it's not really
useful as a repl to be used from emacs. Interim solution:
<code>cider-jack-in</code> and not have the server on.  Have to figure that
one asap.
</p>
</div>
</div>

<div id="outline-container-orga7febdf" class="outline-4">
<h4 id="orga7febdf"><span class="section-number-4">1.21.8</span> Migrations in prod</h4>
<div class="outline-text-4" id="text-1-21-8">
<p>
To run migrations at the start of the app, lein-ring has a config
:init and :destroy that run before and after loading the handler.
</p>
<ul class="org-ul">
<li><a href="https://prasans.info/use%20flyway%20with%20leiningen/">https://prasans.info/use flyway with leiningen/</a></li>
<li><a href="https://devcenter.heroku.com/articles/clojure-web-application">https://devcenter.heroku.com/articles/clojure-web-application</a></li>
<li>Clojure web development essentials (book)</li>
</ul>

<p>
It seems it's the de-facto recommended way, but I still can't see
how you would run it only on 1 of the deployed servers, or
rollback if the migration fails.
</p>
</div>
</div>
<div id="outline-container-org5161886" class="outline-4">
<h4 id="org5161886"><span class="section-number-4">1.21.9</span> uberjar</h4>
<div class="outline-text-4" id="text-1-21-9">
<p>
<code>lein ring uberjar</code> produces a jar that on start it actually runs
the jetty thing. <code>lein uberjar</code> leaves you in the repl.
</p>
</div>
</div>
<div id="outline-container-org93830a8" class="outline-4">
<h4 id="org93830a8"><span class="section-number-4">1.21.10</span> Security</h4>
<div class="outline-text-4" id="text-1-21-10">
<p>
<a href="http://rundis.github.io/blog/2015/buddy_auth_part1.html">http://rundis.github.io/blog/2015/buddy_auth_part1.html</a>
</p>
</div>
</div>
<div id="outline-container-orgeea3356" class="outline-4">
<h4 id="orgeea3356"><span class="section-number-4">1.21.11</span> honeysql and next/jdbc</h4>
</div>
<div id="outline-container-orgc6b32b0" class="outline-4">
<h4 id="orgc6b32b0"><span class="section-number-4">1.21.12</span> deploy</h4>
<div class="outline-text-4" id="text-1-21-12">
<ul class="org-ul">
<li><a href="https://worace.works/2021/04/13/jar-hell-part-2-jvm-deployment-strategies/">https://worace.works/2021/04/13/jar-hell-part-2-jvm-deployment-strategies/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org692bfa0" class="outline-3">
<h3 id="org692bfa0"><span class="section-number-3">1.22</span> Circleci 3part tutorial on duct, aws , terraform</h3>
<div class="outline-text-3" id="text-1-22">
<ul class="org-ul">
<li><a href="https://circleci.com/blog/build-a-clojure-web-app-using-duct/">https://circleci.com/blog/build-a-clojure-web-app-using-duct/</a></li>
<li><a href="https://circleci.com/blog/package-a-clojure-web-application-using-docker/">https://circleci.com/blog/package-a-clojure-web-application-using-docker/</a></li>
<li><a href="https://circleci.com/blog/deploy-a-clojure-web-application-to-aws-using-terraform/">https://circleci.com/blog/deploy-a-clojure-web-application-to-aws-using-terraform/</a></li>
</ul>
</div>
</div>
<div id="outline-container-org7730553" class="outline-3">
<h3 id="org7730553"><span class="section-number-3">1.23</span> integrant,mount,component. clojurians #off-topic 2021-08-07</h3>
<div class="outline-text-3" id="text-1-23">
</div>
<div id="outline-container-orgb3ba159" class="outline-4">
<h4 id="orgb3ba159"><span class="section-number-4">1.23.1</span> links</h4>
<div class="outline-text-4" id="text-1-23-1">
<ul class="org-ul">
<li><a href="https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-2-897aa28112da">https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-2-897aa28112da</a></li>
</ul>
<ul class="org-ul">
<li><a href="https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-1-6e819f51db14">https://medium.com/@TheLaddersEng/stateful-components-in-clojure-part-1-6e819f51db14</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orge9f2e9d" class="outline-2">
<h2 id="orge9f2e9d"><span class="section-number-2">2</span> clojure exceptions</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li><a href="https://grishaev.me/en/clj-book-exceptions/">https://grishaev.me/en/clj-book-exceptions/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org85bc25a" class="outline-2">
<h2 id="org85bc25a"><span class="section-number-2">3</span> logging</h2>
<div class="outline-text-2" id="text-3">
<p>
timbre/log provides also <code>spy</code> and other cool stuff
</p>
</div>
</div>


<div id="outline-container-orge990354" class="outline-2">
<h2 id="orge990354"><span class="section-number-2">4</span> concat trap</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li><a href="https://web.archive.org/web/20190925194705/http://chouser.n01se.net/apply-concat/">https://web.archive.org/web/20190925194705/http://chouser.n01se.net/apply-concat/</a></li>
<li><a href="https://stuartsierra.com/2015/04/26/clojure-donts-concat">https://stuartsierra.com/2015/04/26/clojure-donts-concat</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgdd7fb77" class="outline-2">
<h2 id="orgdd7fb77"><span class="section-number-2">5</span> queryable runtime. "inspectability"</h2>
<div class="outline-text-2" id="text-5">
<p>
cider-apropos is super useful
</p>
<div class="org-src-container">
<pre class="src src-clojure">(apropos "rename-keys")
(clojure.set/rename-keys)

(doc clojure.test)
(find-doc "dynamic")
</pre>
</div>
<pre class="example">
for instance, this is our production jar:
MB_JETTY_PORT=3006 java -Dclojure.server.repl="{:port 50506 :accept clojure.core.server/repl}" -jar 0.40.0.jar
and then just a simple

% nc localhost 50506
user=&gt; (apply require clojure.main/repl-requires)
nil
user=&gt; (apropos "union")
(clojure.set/union)
user=&gt; (apropos "password")
(clj-ldap.client/modify-password metabase.api.session/GET_password_reset_token_valid metabase.api.session/POST_forgot_password metabase.api.session/POST_reset_password metabase.api.user/PUT_:id_password metabase.api.util/POST_password_check metabase.driver.common/default-password-details metabase.email/email-smtp-password metabase.email.messages/send-password-reset-email! metabase.integrations.ldap/ldap-password metabase.integrations.ldap/verify-password metabase.models.database/protected-password metabase.models.user/form-password-reset-url metabase.models.user/set-password! metabase.models.user/set-password-reset-token! metabase.public-settings/enable-password-login metabase.public-settings/password-complexity metabase.util.password/active-password-complexity metabase.util.password/common-passwords-url metabase.util.password/verify-password)
user=&gt;
</pre>
<pre class="example">
  I once wondered how many things were added to clojure.core over the versions. After cloning the Clojure repo, and doing weird regex checks across history in git, I realised I could just do this:

user=&gt; (-&gt;&gt; (vals (ns-publics 'clojure.core))
  #_=&gt;      (keep (comp :added meta))
  #_=&gt;      (frequencies)
  #_=&gt;      (sort-by #(Long/parseLong (subs (key %) 2)))
  #_=&gt;      (run! println))
[1.0 434]
[1.1 38]
[1.2 45]
[1.3 16]
[1.4 8]
[1.5 11]
[1.6 8]
[1.7 19]
[1.8 1]
[1.9 27]
[1.10 8]

That's when I started to really "get" the value of the queryability. I then understood how easily I could implement my own version of clojure.repl/apropos.
Edit: fixed the sorting. (edited)
</pre>
</div>
</div>

<div id="outline-container-org97557fa" class="outline-2">
<h2 id="org97557fa"><span class="section-number-2">6</span> clojure internals</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li><a href="https://aphyr.com/posts/305-clojure-from-the-ground-up-macros">https://aphyr.com/posts/305-clojure-from-the-ground-up-macros</a></li>
<li><a href="https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie">https://lambdaisland.com/blog/2021-08-25-classpath-is-a-lie</a></li>
<li><a href="http://blog.kdgregory.com/2016/05/how-and-when-clojure-compiles-your-code.html">http://blog.kdgregory.com/2016/05/how-and-when-clojure-compiles-your-code.html</a></li>
<li><a href="https://www.youtube.com/watch?v=2SGFeegEt9E">https://www.youtube.com/watch?v=2SGFeegEt9E</a> &lt;- decompilation</li>
<li><a href="https://dev.to/dpsutton/exploring-the-core-cache-api-57al">https://dev.to/dpsutton/exploring-the-core-cache-api-57al</a></li>
<li><a href="https://worace.works/2021/04/13/jar-hell-part-2-jvm-deployment-strategies/">https://worace.works/2021/04/13/jar-hell-part-2-jvm-deployment-strategies/</a></li>
<li><a href="https://www.deepbluelambda.org/programming/clojure/how-clojure-works-a-simple-namespace">https://www.deepbluelambda.org/programming/clojure/how-clojure-works-a-simple-namespace</a></li>
<li><a href="https://www.deepbluelambda.org/programming/clojure/how-clojure-works-namespace-metadata">https://www.deepbluelambda.org/programming/clojure/how-clojure-works-namespace-metadata</a></li>
<li><a href="https://leiningen.org/reference.html">https://leiningen.org/reference.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgb220b90" class="outline-2">
<h2 id="orgb220b90"><span class="section-number-2">7</span> data-driven</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=IZlt6hH8YiA">https://www.youtube.com/watch?v=IZlt6hH8YiA</a></li>
<li><a href="https://www.youtube.com/watch?v=kuNxVXnmjHA">https://www.youtube.com/watch?v=kuNxVXnmjHA</a></li>
<li><a href="https://www.youtube.com/watch?v=zznwKCifC1A">https://www.youtube.com/watch?v=zznwKCifC1A</a></li>
<li><a href="https://www.youtube.com/watch?v=WtdegIqQbrg">https://www.youtube.com/watch?v=WtdegIqQbrg</a></li>
</ul>
</div>
</div>

<div id="outline-container-org8aa6a4f" class="outline-2">
<h2 id="org8aa6a4f"><span class="section-number-2">8</span> simple stu halloway</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=cidchWg74Y4">https://www.youtube.com/watch?v=cidchWg74Y4</a> simplicity &#x2026;</li>
<li><a href="https://www.youtube.com/watch?v=f_Fi8YXt2fs">https://www.youtube.com/watch?v=f_Fi8YXt2fs</a></li>
</ul>
</div>
</div>

<div id="outline-container-org0f9feda" class="outline-2">
<h2 id="org0f9feda"><span class="section-number-2">9</span> cljs</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org77b46aa" class="outline-3">
<h3 id="org77b46aa"><span class="section-number-3">9.1</span> storybook</h3>
<div class="outline-text-3" id="text-9-1">
<p>
<a href="https://dev.to/shaolang/storybook-js-with-shadow-cljs-2n6n">https://dev.to/shaolang/storybook-js-with-shadow-cljs-2n6n</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgf53a39e" class="outline-2">
<h2 id="orgf53a39e"><span class="section-number-2">10</span> core.async</h2>
<div class="outline-text-2" id="text-10">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=VrmfuuHW_6w&amp;t=2s">https://www.youtube.com/watch?v=VrmfuuHW_6w&amp;t=2s</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgec47a11" class="outline-2">
<h2 id="orgec47a11"><span class="section-number-2">11</span> java interop</h2>
<div class="outline-text-2" id="text-11">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=bvI1BNgGp0k">https://www.youtube.com/watch?v=bvI1BNgGp0k</a></li>
</ul>
</div>
</div>


<div id="outline-container-org264489b" class="outline-2">
<h2 id="org264489b"><span class="section-number-2">12</span> tricky flatten</h2>
<div class="outline-text-2" id="text-12">
<ul class="org-ul">
<li><a href="https://web.archive.org/web/20190925194705/http://chouser.n01se.net/apply-concat/">https://web.archive.org/web/20190925194705/http://chouser.n01se.net/apply-concat/</a></li>
<li>stuart sierra's clojure don'ts</li>
<li></li>
</ul>
</div>
</div>
<div id="outline-container-orgd2d0c96" class="outline-2">
<h2 id="orgd2d0c96"><span class="section-number-2">13</span> modern clojurescript</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li><a href="https://www.learn-clojurescript.com/section-2/lesson-13-interacting-with-javascript-data/">https://www.learn-clojurescript.com/section-2/lesson-13-interacting-with-javascript-data/</a></li>
<li><a href="https://davidvujic.blogspot.com/2021/09/clojurescript-amplified.html">https://davidvujic.blogspot.com/2021/09/clojurescript-amplified.html</a> material-ui, storybook, aws amplify</li>
<li></li>
</ul>
</div>
</div>

<div id="outline-container-org87b6738" class="outline-2">
<h2 id="org87b6738"><span class="section-number-2">14</span> clojure integrant and the like</h2>
<div class="outline-text-2" id="text-14">
<ul class="org-ul">
<li><a href="https://grishaev.me/en/clj-book-systems/#loss-of-keys">https://grishaev.me/en/clj-book-systems/#loss-of-keys</a></li>
<li><a href="https://circleci.com/blog/build-a-clojure-web-app-using-duct/">https://circleci.com/blog/build-a-clojure-web-app-using-duct/</a></li>
<li><a href="https://www.karimarttila.fi/clojure/2020/09/07/clojure-integrant-exercise.html">https://www.karimarttila.fi/clojure/2020/09/07/clojure-integrant-exercise.html</a></li>
<li><a href="https://www.youtube.com/watch?v=1siSPGUu9JQ">https://www.youtube.com/watch?v=1siSPGUu9JQ</a> stuart sierra explains why protocols and components</li>
</ul>
</div>
</div>

<div id="outline-container-org75f9310" class="outline-2">
<h2 id="org75f9310"><span class="section-number-2">15</span> holy lambda!</h2>
<div class="outline-text-2" id="text-15">
<ul class="org-ul">
<li>lein new holy-lambda holy-lambda-example</li>
<li>nix-shell -p aws-sam-cli</li>
<li>aws login</li>
<li>AWS_PROFILE=my_profile sam local invoke ExampleLambdaFunction &#x2013;region eu-west-1</li>
<li>AWS_PROFILE=my_profile sam local start-api &#x2013;region eu-west-1</li>
<li>AWS_PROFILE=my_profile sam deploy &#x2013;guided &#x2013;region eu-west-1</li>
<li>http <a href="https://1232323abcd.execute-api.eu-west-1.amazonaws.com">https://1232323abcd.execute-api.eu-west-1.amazonaws.com</a></li>
<li>AWS_PROFILE=rgrau sam delete &#x2013;region eu-west-1</li>
</ul>
</div>
</div>

<div id="outline-container-org21b3da6" class="outline-2">
<h2 id="org21b3da6"><span class="section-number-2">16</span> web dev</h2>
<div class="outline-text-2" id="text-16">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=M97jWSKoV3k">https://www.youtube.com/watch?v=M97jWSKoV3k</a></li>
</ul>
</div>
</div>




<div id="outline-container-org508e44e" class="outline-2">
<h2 id="org508e44e"><span class="section-number-2">17</span> nested filtering, some, any , every , filter&#x2026;.</h2>
<div class="outline-text-2" id="text-17">
<p>
There's a weird nice relation between set/* functions, and using
sets as containers for keywords, that are evaluated as functions.
</p>

<p>
filter + comp + set seems powerful
</p>
<div class="org-src-container">
<pre class="src src-clojure">(-&gt;&gt; @evts (map json/decode) (filter (comp #{"invoice.payment_failed" "charge.failed"} #(get % "type"))))

(select-keys (-&gt;&gt; @evts (map json/decode) (group-by #(get % "type"))) ["invoice.payment_failed" "charge.failed"])

(filter (comp #{"foo" "bar"} :id) [{:id "foo" :n 1 } {:id "bar" :n 2 } {:id "baz" :n 3 }])

(when (#{"charge.failed" "invoice.payment_failed"} (get {"type" "charge.failed"} "type"))
  "yes")

(when (some #{"charge.failed" "invoice.payment_failed"} [(get {"type" "charge.failed"} "type")])
  "yes")

</pre>
</div>
</div>
</div>
<div id="outline-container-org9960e51" class="outline-2">
<h2 id="org9960e51"><span class="section-number-2">18</span> list all implementations of a defmethod</h2>
<div class="outline-text-2" id="text-18">
<div class="org-src-container">
<pre class="src src-clojure">(keys (.getMethodTable ig/init-key))
</pre>
</div>
</div>
</div>

<div id="outline-container-org67b616a" class="outline-2">
<h2 id="org67b616a"><span class="section-number-2">19</span> find all public methods of a namespace</h2>
<div class="outline-text-2" id="text-19">
<div class="org-src-container">
<pre class="src src-clojure">(ns-publics *ns*)
</pre>
</div>
</div>
</div>


<div id="outline-container-org1ae93d4" class="outline-2">
<h2 id="org1ae93d4"><span class="section-number-2">20</span> cli and tools and deps</h2>
<div class="outline-text-2" id="text-20">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=8aCO_wNuScQ">https://www.youtube.com/watch?v=8aCO_wNuScQ</a></li>
</ul>
</div>
</div>
<div id="outline-container-org3627fc4" class="outline-2">
<h2 id="org3627fc4"><span class="section-number-2">21</span> dependency injection</h2>
<div class="outline-text-2" id="text-21">
<ul class="org-ul">
<li><a href="https://www.evalapply.org/posts/which-clojure-codebases-to-read-how-and-why/">https://www.evalapply.org/posts/which-clojure-codebases-to-read-how-and-why/</a></li>
<li><a href="https://www.yegor256.com/2014/10/03/di-containers-are-evil.html">https://www.yegor256.com/2014/10/03/di-containers-are-evil.html</a></li>
<li><a href="https://softwareengineering.stackexchange.com/questions/19203/what-are-the-benefits-of-using-dependency-injection-and-ioc-containers">https://softwareengineering.stackexchange.com/questions/19203/what-are-the-benefits-of-using-dependency-injection-and-ioc-containers</a></li>
<li><a href="https://www.reddit.com/r/Clojure/comments/6e2o57/how_do_you_manage_global_configuration_options_in/">https://www.reddit.com/r/Clojure/comments/6e2o57/how_do_you_manage_global_configuration_options_in/</a></li>
<li><a href="https://yogthos.net/posts/2015-10-01-Compojure-API.html">https://yogthos.net/posts/2015-10-01-Compojure-API.html</a></li>
<li><a href="https://yogthos.net/posts/2015-12-05-LuminusComponents.html">https://yogthos.net/posts/2015-12-05-LuminusComponents.html</a></li>
<li><a href="https://lambdaisland.com/blog/2018-02-09-reloading-woes">https://lambdaisland.com/blog/2018-02-09-reloading-woes</a></li>
<li><a href="https://slipset.github.io/posts/config">https://slipset.github.io/posts/config</a></li>
<li><a href="https://kumarshantanu.medium.com/dependency-injection-with-clojure-using-dime-af57b140bd3f">https://kumarshantanu.medium.com/dependency-injection-with-clojure-using-dime-af57b140bd3f</a></li>
<li><a href="https://puredanger.github.io/tech.puredanger.com/2014/01/03/clojure-dependency-injection/">https://puredanger.github.io/tech.puredanger.com/2014/01/03/clojure-dependency-injection/</a></li>
<li><a href="https://www.juxt.pro/blog/abstract-clojure">https://www.juxt.pro/blog/abstract-clojure</a></li>
<li><a href="https://clojureverse.org/t/dependency-injection-in-clojure/1723/6">https://clojureverse.org/t/dependency-injection-in-clojure/1723/6</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgeef31aa" class="outline-2">
<h2 id="orgeef31aa"><span class="section-number-2">22</span> clojure codebases</h2>
<div class="outline-text-2" id="text-22">
<ul class="org-ul">
<li><a href="https://www.evalapply.org/posts/which-clojure-codebases-to-read-how-and-why/">https://www.evalapply.org/posts/which-clojure-codebases-to-read-how-and-why/</a></li>
<li><a href="https://github.com/dharrigan/startrek">https://github.com/dharrigan/startrek</a></li>
</ul>
</div>
</div>


<div id="outline-container-org2d8cc12" class="outline-2">
<h2 id="org2d8cc12"><span class="section-number-2">23</span> REPL large objects</h2>
<div class="outline-text-2" id="text-23">
<ul class="org-ul">
<li>profiles.clj</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojure">:global-vars {*print-length* 5
	      *print-level* 5}

</pre>
</div>
<ul class="org-ul">
<li>overwrite default "to string"</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojure">(defmethod print-method martian.core.Martian [^martian.core.Martian v ^java.io.Writer w]
(.write w (str "#martian.core.Martian" (prn-str (select-keys v [:api-root])))))
</pre>
</div>

<p>
In emacs you might still hit <a href="https://github.com/clojure-emacs/cider/issues/2856">https://github.com/clojure-emacs/cider/issues/2856</a>
</p>
<div class="org-src-container">
<pre class="src src-elisp">(<span style="font-weight: bold;">setq</span> cider-repl-use-pretty-printing nil)
</pre>
</div>
</div>
</div>


<div id="outline-container-org97dc828" class="outline-2">
<h2 id="org97dc828"><span class="section-number-2">24</span> inspect last result in emacs</h2>
<div class="outline-text-2" id="text-24">
<p>
<code>m-x cider-inspect-last-result</code> or <code>m-x cider-inspect-expr *1</code>
</p>
</div>
</div>
<div id="outline-container-orgee27e54" class="outline-2">
<h2 id="orgee27e54"><span class="section-number-2">25</span> packaging lein deps.edn</h2>
<div class="outline-text-2" id="text-25">
<p>
<a href="https://github.com/metosin/packaging-clojure-examples">https://github.com/metosin/packaging-clojure-examples</a>
</p>
</div>
</div>

<div id="outline-container-org40776f3" class="outline-2">
<h2 id="org40776f3"><span class="section-number-2">26</span> forms</h2>
<div class="outline-text-2" id="text-26">
<ul class="org-ul">
<li><a href="http://inside-out.matt.is/">http://inside-out.matt.is/</a></li>
<li><a href="https://github.com/tonsky/rum">https://github.com/tonsky/rum</a></li>
<li><a href="https://biffweb.com/p/demo-dev-in-prod">https://biffweb.com/p/demo-dev-in-prod</a></li>
</ul>
</div>
</div>

<div id="outline-container-org6099974" class="outline-2">
<h2 id="org6099974"><span class="section-number-2">27</span> state machine to parse files</h2>
<div class="outline-text-2" id="text-27">
<p>
  rgm 12:42 AM
  I'm hunting for possible libraries or techniques for a
kind of task that almost certainly has a googleable name, but I don't
know it: I have plaintext e-mails coming in and want to act on their
message bodies. They're not exactly parseable (ie. I don't think a
grammar exists, so it doesn't feel like instaparse would work) and
they'd be tedious to regex, though I suppose that might eventually
work. Some parts of the body are (probably accidentally) TSV as a
result of doing layout in plaintext.I guess I'm after &#x2026; some
data-defined way to establish zones relative to consistent landmarks,
and say, ok, use this regex on the line 2 lines later and give me the
groups. I can imagine doing a bunch of this with drop-until landmark,
etc. working at the level of a line-seq.But I'm wondering if there are
good approaches for almost-structured data that operates above lines
and regexes and seqs and below formal grammars and parsing.  hiredman
</p>


<p>
12:50 AM a state machine 12:53 (reduce (fn [[state-name data] line]
(case state-name ..do stuff with line and data based on the content of
line and the value of state-name and return a possibly new state&#x2026;))
[:init {}] lines). like if you are in :init and see a blank line then
move to :after-email-headers or whatever, if you are in
:after-email-headers and you see the columns headers for the tsv then
move to :accumulate-tsv, and in :accumulate-tsv add the lines to data
until a line is blank
</p>
</div>
</div>

<div id="outline-container-orga98b7bb" class="outline-2">
<h2 id="orga98b7bb"><span class="section-number-2">28</span> tap&gt;</h2>
<div class="outline-text-2" id="text-28">
<div class="org-src-container">
<pre class="src src-clojure">(-&gt; {:q []}
	(update :q conj "a")
	(update :q conj "b"))

(def ml (atom {:q []}))
;;(remove-tap clojure.pprint/pprint)
(add-tap #(swap! ml update :q conj %))
(loop [[hd &amp; tl] [1 2 3]]
  (tap&gt; hd)
  (when tl
    (recur tl)))
</pre>
</div>

<p>
get(dict, k)
update(dict, k, f, args**)
reset(dict, k, val, args**)
inc
update(d,'foo', inc)
</p>
</div>
</div>
<div id="outline-container-org2b16ce5" class="outline-2">
<h2 id="org2b16ce5"><span class="section-number-2">29</span> clojure -Sdescribe</h2>
<div class="outline-text-2" id="text-29">
<p>
You'll see that there's
</p>
</div>
</div>

<div id="outline-container-org9969fea" class="outline-2">
<h2 id="org9969fea"><span class="section-number-2">30</span> miniupdates in python</h2>
<div class="outline-text-2" id="text-30">
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> copy
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">update</span>(d, k, f, *args):
    <span style="font-weight: bold; font-style: italic;">_c</span>=copy.deepcopy(d)
    <span style="font-weight: bold; font-style: italic;">_c</span>[k]=f(d[k], *args)
    <span style="font-weight: bold;">return</span> _c

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">myappend</span>(a,v):
    <span style="font-weight: bold; font-style: italic;">_a</span>=a.copy()
    _a.append(v)
    <span style="font-weight: bold;">return</span> _a

<span style="font-weight: bold; font-style: italic;">d</span>={<span style="font-style: italic;">'a'</span>: [1,2,3]}
update(d, <span style="font-style: italic;">'a'</span>, myappend, <span style="font-style: italic;">'hola'</span>)

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">swap</span>(f):
    <span style="font-weight: bold;">return</span> <span style="font-weight: bold;">lambda</span> x,y: f(y,x)

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">swap</span>(f):
    <span style="font-weight: bold;">return</span> <span style="font-weight: bold;">lambda</span> *args: f(*<span style="font-weight: bold;">reversed</span>(args))

<span style="font-weight: bold;">list</span>(update(d, <span style="font-style: italic;">'a'</span>, swap(<span style="font-weight: bold;">map</span>), inc)[<span style="font-style: italic;">'a'</span>])

</pre>
</div>
</div>
</div>

<div id="outline-container-org7aad4f0" class="outline-2">
<h2 id="org7aad4f0"><span class="section-number-2">31</span> proj from scratche</h2>
<div class="outline-text-2" id="text-31">
<ul class="org-ul">
<li>create deps.edn -&gt; {:deps &#x2026;}</li>
<li>nix-shell -p neil</li>
<li>neil add build</li>
<li>neil dep add com.github.seancorfield/honeysql</li>
<li>3 things to build an uberjar:
<ul class="org-ul">
<li>(:gen-class) in the main</li>
<li>def lib</li>
<li>add :main 'clojaws.core</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Raimon Grau</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.1.9)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
